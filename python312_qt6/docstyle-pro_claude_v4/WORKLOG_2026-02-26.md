# DocStyle Pro 작업 기록 (2026-02-26)

이 문서는 오늘 세션에서 진행한 요구사항/분석/구현/검증/배포 이력을 학습용으로 상세 정리한 로그입니다.

---

## 1) 목표와 요청 흐름

오늘의 핵심 목표는 크게 5가지였습니다.

1. 템플릿 썸네일 디자인과 Word 결과물의 일치도 개선
2. Word 저장물의 레이아웃 품질(자동 보정, 스타일 프리셋) 고도화
3. 웹 사용을 위한 FastAPI + Next.js 기반 웹 버전 추가
4. 웹 UI를 데스크탑 사용 흐름에 가깝게 재설계
5. Insight Lab / AI 작성 기능 / AI 키 설정 등 빠진 기능 보완

---

## 2) 주요 구현 이력 (기능 단위)

### A. 템플릿-워드 디자인 정합성 개선

#### A-1. 템플릿 색상 동기화
- 배경: GUI 템플릿 색상과 Node docx 템플릿 색상이 불일치하여 썸네일과 Word 결과가 달라 보임.
- 조치: Node 템플릿 색상 팔레트를 GUI 기준에 맞춰 동기화.
- 관련 커밋:
  - `c1d7455` feat: sync template palette values with thumbnail presets

#### A-2. 헤더/푸터 장식 바 반영
- 배경: 템플릿 썸네일의 상단 컬러 영역/하단 강조 바 느낌이 Word에서 보이지 않음.
- 원인: 단순 paragraph 기반 데코는 Word 렌더링에서 기대처럼 나타나지 않음.
- 조치:
  - `engine/core/builder.js`에서 header/footer 데코를 table + shading 방식으로 안정화.
  - Editorial 2단 섹션에서 header/footer 누락되던 부분 보강.

---

### B. 문서 자동 보정/스타일 고도화

#### B-1. Auto Polish 파이프라인 추가
- 위치: `engine/core/builder.js`, `engine/core/elements.js`
- 구현:
  - 텍스트 중심 문서 판별
  - 섹션 전환 구분자(`section_divider`) 자동 삽입
  - 헤딩 직후 리드 문단(`lead`) 자동 적용
  - 장문 문단 분할
- 목표: Word/Pages처럼 글의 리듬과 레이아웃을 자동 정돈.

#### B-2. Auto Polish 강도 레벨
- 레벨: weak / normal / strong / off
- UI 연동: `gui/settings_panel.py`
- 템플릿 추천 레벨도 반영.

#### B-3. 스타일 프리셋(Word 디자인 메뉴 유사 경험)
- 프리셋: template / classic / modern / report / magazine
- 적용: 글자 크기, 줄간격, 제목-본문 spacing, 정렬 감도.
- 위치: `engine/core/builder.js`, `engine/core/elements.js`, `gui/settings_panel.py`

#### B-4. 추천 매핑 외부화
- 기존: 코드 내부 키워드/ID 로직
- 변경: `gui/template_auto_polish_levels.json`로 분리
- 효과: 운영 중 튜닝 용이성 확보.

---

### C. 데스크탑 UX 보완

#### C-1. 파일 로드 클릭 불가 버그 수정
- 원인: `FileDropZone` 내부 QLabel들이 mouse event를 소비.
- 조치: `WA_TransparentForMouseEvents` 적용.
- 위치: `gui/file_drop_zone.py`

#### C-2. Structure Doctor 도입
- 신규: `gui/structure_doctor.py`
- 기능:
  - 구조 점검(레벨 점프/중복/긴 제목/점수)
  - 구조 정리(heading 정규화/빈 제목 보정/blank line 정리)
- UI 연동: 에디터 툴바 버튼 추가 (`구조 정리`, `구조 점검`)
- 이후 개선: 점검 결과 클릭 시 해당 줄 이동.

#### C-3. 구조 점검 결과 패널 위치 이동
- 요청 반영: 좌측 에디터 하단 -> 우측 PreviewPanel로 이동
- 위치: `gui/preview_panel.py`, `gui/main_window.py`

관련 커밋:
- `d28a55b` feat: add structure doctor panel with issue line-jump

---

### D. 웹 버전 추가 (Backend + Frontend)

#### D-1. FastAPI 백엔드 추가
- 신규 파일:
  - `web/api.py`
  - `web/run_api.py`
  - `web/__init__.py`
- 주요 엔드포인트:
  - `GET /health`
  - `GET /templates`
  - `POST /convert`
  - `POST /ai/organize`, `/ai/draft`, `/ai/toc`, `/ai/inline-edit`
  - `POST /structure/check`, `/structure/normalize`
  - `POST /insight/guide`, `/insight/chat`
  - `GET /settings/ai`, `POST /settings/ai`

#### D-2. uv 기반 실행 체계
- 추가: `pyproject.toml`, `uv.lock`
- 문서: `WEB_API.md`
- 실행:
  - `uv sync`
  - `uv run python -m web.run_api`

#### D-3. Next.js 프론트 추가
- 디렉터리: `web_frontend/`
- 핵심 화면:
  - 좌측: AI 작성 + 원고 입력 + 정리 + 변환
  - 중앙: 템플릿 라이브러리/카테고리
  - 우측: 결과/구조 점검/인사이트/AI 설정

관련 커밋:
- `3546b12` feat: add web API and desktop-like web workflow

---

### E. 웹 UI 데스크탑 유사화 작업

요청: "데스크탑과 UI가 다르다", "템플릿 영역 스크롤이 길다", "인사이트 위치 조정", "AI 작성 기능 누락" 등

반영 사항:
- 템플릿 카드 썸네일을 데스크탑 스타일과 유사하게 재구성
  - 상단 헤더, 좌측 accent rail, 우상단 ID 배지, 본문 mock block
  - 선택 테두리/그림자/정보 패널 동작 정돈
- 템플릿 카테고리 필터 탭 추가(스크롤 감소)
- 인사이트랩 섹션을 우측 패널(문단 구조 점검 아래)로 이동
- AI 목차 기획 / AI 본문 초안 / AI 원고 정리를 좌측 패널로 이동/추가
- Insight Lab 사용을 위한 AI 키 설정 패널(Provider + Key) 추가

---

## 3) 보안/운영 메모

### AI 키 처리
- 데스크탑/웹 공통으로 `settings/ai_credentials.json` 파일을 사용.
- 웹에 `GET/POST /settings/ai`를 추가해 설정 UI를 연결함.
- 현재 구현은 단일 서버 파일 기반 저장이므로, 멀티유저 공개 서비스 전환 시 다음 보강 필요:
  - 사용자 인증
  - 사용자별 키 저장
  - 암호화 저장(KMS/암호화 키 관리)
  - 감사 로그/접근 제어

### 민감정보 주의
- 세션 중 `settings/ai_credentials.json` 내용 확인 과정에서 실제 키 문자열이 노출된 적이 있음.
- 학습/공유본에서는 반드시 키를 회전 및 마스킹 처리해야 함.

---

## 4) 실행/검증 기록 요약

오늘 반복적으로 수행한 검증:

- Python
  - `python3 -m py_compile ...`
  - `uv run python -m py_compile ...`
- Node/Engine
  - `node --check ...`
  - `node engine/generate.js ...`
- Frontend
  - `npm install`
  - `npm run build`
- Web API
  - `uv sync`
  - `uv run python -m web.run_api`
  - `/health`, `/templates`, `/convert` 등 smoke 확인

상태:
- 백엔드/프론트 모두 빌드 가능한 상태 확인
- `main` 브랜치 푸시 완료

---

## 5) Git 이력 (오늘 세션 핵심)

최근 관련 커밋:

- `c1d7455` feat: sync template palette values with thumbnail presets
- `d27747d` feat: add auto-polish and style-preset rendering pipeline
- `b4e7bae` feat: improve GUI style controls and file-load interaction
- `d28a55b` feat: add structure doctor panel with issue line-jump
- `3546b12` feat: add web API and desktop-like web workflow
- `587c58d` chore: ignore and untrack frontend build artifacts

태그:
- `웹버전추가` (원요청 태그)

---

## 6) 산출물/환경 정리

### 정리한 항목
- `.gitignore` 업데이트
  - `web_frontend/.next/`
  - `web_frontend/.env.local`
  - `web_frontend/node_modules/`
- 기존에 올라간 빌드 산출물/로컬 파일은 추적 해제 및 제거 커밋 반영

### 현재 권장 실행

Backend:
```bash
uv sync
uv run python -m web.run_api
```

Frontend:
```bash
cd web_frontend
npm install
npm run dev
```

---

## 7) 내일 이어서 할 일 (제안)

1. 배포 파이프라인 (Vercel + FastAPI 호스팅) 정식화
2. 멀티유저 기준 AI 키 저장 구조(인증 + 암호화) 설계/구현
3. 템플릿 썸네일 1:1 시각 튜닝 마감
4. Insight Lab UX(질문 히스토리/저장/검색 필터) 고도화

---

## 8) 참고 파일 목록 (이번 세션에서 주요 수정)

- Desktop/Engine
  - `engine/core/builder.js`
  - `engine/core/elements.js`
  - `bridge/json_builder.py`
  - `gui/settings_panel.py`
  - `gui/main_window.py`
  - `gui/file_drop_zone.py`
  - `gui/structure_doctor.py`
  - `gui/preview_panel.py`
  - `gui/template_auto_polish_levels.json`

- Web Backend
  - `web/api.py`
  - `web/run_api.py`
  - `web/__init__.py`
  - `WEB_API.md`
  - `pyproject.toml`
  - `uv.lock`

- Web Frontend
  - `web_frontend/app/page.js`
  - `web_frontend/app/globals.css`
  - `web_frontend/app/layout.js`
  - `web_frontend/package.json`
  - `web_frontend/next.config.mjs`
  - `web_frontend/README.md`
  - `web_frontend/.env.example`
